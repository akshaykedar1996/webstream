import { useMemo } from 'react';
import { useLastReadData } from '../useLastReadData';
import { getLastReceived } from '../../utils';
import { useChatContext } from '../../../../context/ChatContext';
import { useComponentContext } from '../../../../context/ComponentContext';
import { useChannelStateContext } from '../../../../context';
import { useLastDeliveredData } from '../useLastDeliveredData';
export const useMessageListElements = (props) => {
    const { channelUnreadUiState, enrichedMessages, internalMessageProps, lastOwnMessage, messageGroupStyles, messages, renderMessages, returnAllReadData, threadList, } = props;
    const { customClasses } = useChatContext('useMessageListElements');
    const { channel } = useChannelStateContext();
    const components = useComponentContext('useMessageListElements');
    // get the readData, but only for messages submitted by the user themselves
    const readData = useLastReadData({
        channel,
        lastOwnMessage,
        messages,
        returnAllReadData,
    });
    const ownMessagesDeliveredToOthers = useLastDeliveredData({
        channel,
        lastOwnMessage,
        messages,
        returnAllReadData,
    });
    const lastReceivedMessageId = useMemo(() => getLastReceived(enrichedMessages), [enrichedMessages]);
    const elements = useMemo(() => renderMessages({
        channelUnreadUiState,
        components,
        customClasses,
        lastOwnMessage,
        lastReceivedMessageId,
        messageGroupStyles,
        messages: enrichedMessages,
        ownMessagesDeliveredToOthers,
        readData,
        sharedMessageProps: { ...internalMessageProps, returnAllReadData, threadList },
    }), 
    // eslint-disable-next-line react-hooks/exhaustive-deps
    [
        enrichedMessages,
        internalMessageProps,
        lastOwnMessage,
        lastReceivedMessageId,
        messageGroupStyles,
        channelUnreadUiState,
        readData,
        renderMessages,
        returnAllReadData,
        threadList,
    ]);
    return elements;
};
